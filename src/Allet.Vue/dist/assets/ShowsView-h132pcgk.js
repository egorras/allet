import{d as z,c as l,p as J,F as k,e as N,o as s,n as L,b as r,t as h,f as P,w as O,h as Y,r as j,_ as Q,l as p,q as X,i as Z,g as F,a as M,s as $,u as ee}from"./index-Bo3-Od0e.js";import{g as A}from"./client-0yvi7SZB.js";function te(m){return A("/shows",m)}function ne(){return A("/shows/tags")}const ae={class:"calendar-grid"},se={class:"day-number"},oe={class:"event-time"},re=z({__name:"CalendarGrid",props:{days:{},currentYear:{},currentMonth:{}},setup(m){const y=m;function w(a){return parseInt(a.slice(8,10),10)}function b(a){const i=parseInt(a.slice(5,7),10),o=parseInt(a.slice(0,4),10);return i===y.currentMonth&&o===y.currentYear}function c(a){return a===new Date().toISOString().slice(0,10)}function t(a){return a?new Date(a).toTimeString().slice(0,5):""}return(a,i)=>{const o=j("router-link");return s(),l("div",ae,[i[0]||(i[0]=J('<div class="calendar-header" data-v-c92e18e5>Mon</div><div class="calendar-header" data-v-c92e18e5>Tue</div><div class="calendar-header" data-v-c92e18e5>Wed</div><div class="calendar-header" data-v-c92e18e5>Thu</div><div class="calendar-header" data-v-c92e18e5>Fri</div><div class="calendar-header" data-v-c92e18e5>Sat</div><div class="calendar-header" data-v-c92e18e5>Sun</div>',7)),(s(!0),l(k,null,N(m.days,u=>(s(),l("div",{key:u.date,class:L(["calendar-day",{"other-month":!b(u.date),today:c(u.date)}])},[r("div",se,h(w(u.date)),1),(s(!0),l(k,null,N(u.shows,d=>(s(),P(o,{key:d.id,to:`/productions/${d.productionId}`,class:"calendar-event",title:`${d.title} — ${d.venueName||""} ${t(d.date)}`},{default:O(()=>[r("span",oe,h(t(d.date)),1),Y(" "+h(d.title),1)]),_:2},1032,["to","title"]))),128))],2))),128))])}}}),le=Q(re,[["__scopeId","data-v-c92e18e5"]]),ce={class:"d-flex justify-content-between align-items-center mb-3"},ie={class:"d-flex align-items-center gap-2"},ue={key:0},de={key:1,class:"mb-3 d-flex flex-wrap align-items-center gap-2"},ve=["onClick"],me={key:2},fe={key:3},he=z({__name:"ShowsView",props:{productionId:{}},setup(m){const y=m,w=ee(),b=new Date,c=p(b.getFullYear()),t=p(b.getMonth()+1),a=p([]),i=p([]),o=p(new Set),u=p(!0),d=$(()=>new Date(c.value,t.value-1,1).toLocaleString("en-US",{month:"long",year:"numeric"})),V=$(()=>y.productionId||w.params.productionId||"");function E(){const n=new Date(c.value,t.value-1,1),e=new Date(c.value,t.value,0),C=(n.getDay()+6)%7,v=new Date(n);v.setDate(v.getDate()-C);const T=(e.getDay()+6)%7,H=T===6?0:6-T,I=new Date(e);I.setDate(I.getDate()+H+1);const _=new Map;for(const g of a.value){if(!g.date)continue;const x=g.date.slice(0,10);_.has(x)||_.set(x,[]),_.get(x).push(g)}const B=[],D=new Date(v);for(;D<I;){const g=D.toISOString().slice(0,10);B.push({date:g,shows:_.get(g)||[]}),D.setDate(D.getDate()+1)}return B}const S=p([]),G=$(()=>(o.value.size===0,S.value));async function f(){u.value=!0;try{const n={year:String(c.value),month:String(t.value)};V.value&&(n.productionId=V.value),o.value.size>0&&(n.tags=Array.from(o.value).join(",")),a.value=await te(n),S.value=E()}finally{u.value=!1}}function K(){t.value===1?(t.value=12,c.value--):t.value--,f()}function q(){t.value===12?(t.value=1,c.value++):t.value++,f()}function R(){const n=new Date;c.value=n.getFullYear(),t.value=n.getMonth()+1,f()}function U(n){const e=new Set(o.value);e.has(n)?e.delete(n):e.add(n),o.value=e,f()}function W(){o.value=new Set,f()}return X(()=>w.params.productionId,()=>f()),Z(async()=>{i.value=await ne(),await f()}),(n,e)=>{const C=j("router-link");return s(),l(k,null,[r("div",ce,[e[0]||(e[0]=r("h1",{class:"mb-0"},"Shows",-1)),r("div",ie,[r("button",{class:"btn btn-sm btn-outline-secondary",onClick:K},"«"),r("strong",null,h(d.value),1),r("button",{class:"btn btn-sm btn-outline-secondary",onClick:q},"»"),r("button",{class:"btn btn-sm btn-outline-primary ms-2",onClick:R},"Today")])]),m.productionId?(s(),l("p",ue,[e[2]||(e[2]=Y(" Showing performances for a specific production. ",-1)),F(C,{to:"/shows",class:"ms-2 btn btn-sm btn-outline-secondary"},{default:O(()=>[...e[1]||(e[1]=[Y("Clear filter",-1)])]),_:1})])):M("",!0),i.value.length>0?(s(),l("div",de,[e[3]||(e[3]=r("span",{class:"text-muted small me-1"},"Tags:",-1)),(s(!0),l(k,null,N(i.value,v=>(s(),l("button",{key:v,class:L(["btn btn-sm",o.value.has(v)?"btn-primary":"btn-outline-secondary"]),onClick:T=>U(v)},h(v),11,ve))),128)),o.value.size>0?(s(),l("button",{key:0,class:"btn btn-sm btn-link text-decoration-none",onClick:W},"Clear")):M("",!0)])):M("",!0),u.value?(s(),l("div",me,[...e[4]||(e[4]=[r("p",null,[r("em",null,"Loading...")],-1)])])):(s(),l("div",fe,[F(le,{days:G.value,currentYear:c.value,currentMonth:t.value},null,8,["days","currentYear","currentMonth"])]))],64)}}});export{he as default};
